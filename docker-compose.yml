services:
  shijangme-api:
    container_name: shijangme-api
    restart: always
    image: node:20.10.0
    ports:
      - 3003:4007
    volumes:
      - ./:/usr/src/shijangme
    working_dir: /usr/src/shijangme

    networks:
      - shijangme-monorepo-network

    # FOR PRODUCTION
    command: bash -c "rm -rf dist && npm install && npm run build && npm run start:prod"

  # shijangme-batch:
  #   container_name: shijangme-batch
  #   restart: always
  #   image: node:20.10.0
  #   ports:
  #     - 3004:4008
  #   volumes:
  #     - ./:/usr/src/shijangme-batch
  #   working_dir: /usr/src/shijangme-batch

  #   networks:
  #     - shijangme-monorepo-network

  #   #   # FOR PRODUCTION
  #   command: bash -c "npm install && npm run build && npm run start:prod:batch"

networks:
  shijangme-monorepo-network:
    driver: bridge
